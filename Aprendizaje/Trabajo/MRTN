import pandas as pd
import re

# Ruta del archivo CSV original
input_file_path = '/home/sebastian/Downloads/BI_EST_MRTN_APOY.csv'

# Ruta del archivo CSV de salida
output_file_path = '/home/sebastian/Downloads/BI_EST_MRTN_APOY_cleaned.csv'

# Paso 1: Leer el archivo CSV, especificando las columnas como strings
dtype_spec = {
    'EMPLID': str,
    'ID_CURSO': str,
    'COD_SALA': str,
    'HORA_INICIO': str,
    'HORA_FIN': str
}

df = pd.read_csv(input_file_path, delimiter='|', dtype=dtype_spec, encoding='utf-8')

# Paso 2: Reemplazar caracteres no deseados en las columnas de hora
def clean_time_column(text):
    if pd.isnull(text):
        return ''
    # Eliminar caracteres específicos
    cleaned_text = text.replace('Â', '').replace('M-BM-', '')
    # Opcional: Eliminar cualquier otro carácter no ASCII
    cleaned_text = re.sub(r'[^\x00-\x7F]+', '', cleaned_text)
    return cleaned_text.strip()

df['HORA_INICIO'] = df['HORA_INICIO'].apply(clean_time_column)
df['HORA_FIN'] = df['HORA_FIN'].apply(clean_time_column)

# Paso 3: Reemplazar valores NaN con cadenas vacías en todo el DataFrame
df = df.fillna('')

# Paso 4: Guardar el DataFrame en un archivo CSV con encoding UTF-8 con BOM
df.to_csv(output_file_path, index=False, sep='|', encoding='utf-8-sig')
